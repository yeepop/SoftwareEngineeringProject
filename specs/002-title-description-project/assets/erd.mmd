erDiagram
    USER {
      String id_PK
      String email_UNIQUE
      String username
      String phoneNumber
      String firstName
      String lastName
      String role
      Boolean verified
      String primaryShelterId
      String profilePhotoUrl
      JSON settings
      Date createdAt
      Date updatedAt
      Date deletedAt
    }

    SHELTER {
      String id_PK
      String name
      String slug_UNIQUE
      String contactEmail
      String contactPhone
      JSON address
      Boolean verified
      String primaryAccountUserId_FK
      JSON metadata
      Date createdAt
      Date updatedAt
      Date deletedAt
    }

    ANIMAL {
      String id_PK
      String name
      String species
      String breed
      String sex
      Date dob
      String description
      String status
      String shelterId_FK
      String ownerId_FK
      String medicalSummary
      String createdBy_FK
      Date createdAt
      Date updatedAt
      Date deletedAt
    }

    ANIMALIMAGE {
      String id_PK
      String animalId_FK
      String storageKey
      String url
      String mimeType
      Int width
      Int height
      Int order
      Date createdAt
    }

    APPLICATION {
      String id_PK
      String applicantId_FK
      String animalId_FK
      String type
      String status
      Date submittedAt
      Date reviewedAt
      String reviewNotes
      String assigneeId_FK
      Int version
      String idempotencyKey
      JSON attachments
      Date createdAt
      Date updatedAt
      Date deletedAt
    }

    MEDICALRECORD {
      String id_PK
      String animalId_FK
      String recordType
      Date date
      String provider
      String details
      JSON attachments
      Boolean verified
      String verifiedBy_FK
      String createdBy_FK
      Date createdAt
      Date updatedAt
      Date deletedAt
    }

    ATTACHMENT {
      String id_PK
      String ownerType
      String ownerId
      String storageKey
      String url
      String filename
      String mimeType
      Int size
      String createdBy
      Date createdAt
      Date deletedAt
    }

    NOTIFICATION {
      String id_PK
      String recipientId_FK
      String actorId_FK
      String type
      JSON payload
      Boolean read
      Date createdAt
      Date deliveredAt
      String externalDeliveryStatus
      Int retryCount
      String lastError
    }

    JOB {
      String id_PK
      String type
      String status
      JSON payload
      JSON resultSummary
      String createdBy_FK
      Date createdAt
      Date startedAt
      Date finishedAt
      Int attempts
    }

    AUDITLOG {
      String id_PK
      String actorId_FK
      String action
      String targetType
      String targetId
      JSON before
      JSON after
      String notes
      Date timestamp
      String shelterId_FK
    }

    %% Relationships
    USER ||--o{ APPLICATION : "applicant_applications"
    USER ||--o{ APPLICATION : "assignee_applications"
    USER ||--o{ ANIMAL : "owner_animals"
    USER ||--o{ MEDICALRECORD : "creator_records"
    USER ||--o{ MEDICALRECORD : "verifier_records"
    USER ||--o{ NOTIFICATION : "recipient_notifications"
    USER ||--o{ JOB : "jobs_created"
    USER ||--o{ AUDITLOG : "actor_auditlogs"

    SHELTER ||--o{ ANIMAL : "animals"
    SHELTER ||--o{ AUDITLOG : "shelter_auditlogs"

    ANIMAL ||--o{ ANIMALIMAGE : "images"
    ANIMAL ||--o{ MEDICALRECORD : "medical_records"
    ANIMAL ||--o{ APPLICATION : "applications"